<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Students</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <aside class="sidebar">
        <div class="brand">Library Admin</div>
        <nav>
            <a href="index.html">Dashboard</a>
            <a href="students.html" class="active">Students</a>
            <a href="books.html">Books</a>
            <a href="transaction.html">Transactions</a>
            <a href="payment.html">Payments</a>
            <a href="report.html">Reports</a>
            <a href="backup.html">Backup & Restore</a>
            <a href="#" onclick="logout()" class="logout">Logout</a>
        </nav>
    </aside>

    <main class="content">
        <h1>Student Management</h1>

        <div class="card">
            <h3>Register Student</h3>
            <form onsubmit="addStudent(event)" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                <input id="newId" placeholder="Student ID (e.g., 23-0001)" required>
                <input id="newName" placeholder="Full Name" required>
                <input id="newCourse" placeholder="Course">
                <input id="newDept" placeholder="Department">
                <input id="newEmail" placeholder="Email">
                <button type="submit" class="btn">Add Student</button>
            </form>
        </div>

        <div class="card">
            <input onkeyup="filterTable()" id="search" placeholder="Search students..." style="margin-bottom: 0;">
            <table>
                <thead><tr><th>ID</th><th>Name</th><th>Course</th><th>Dept</th><th>Action</th></tr></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </main>

    <!-- RIGHT SIDEBAR -->
    <aside class="metrics">
        <h3>Summary</h3>
        <div class="metric-card-small"><div class="val" id="metric-students">0</div><div class="lbl">Students</div></div>
        <div class="metric-card-small"><div class="val" id="metric-books">0</div><div class="lbl">Books</div></div>
        <div class="metric-card-small"><div class="val" id="metric-borrowed" style="color:#f97316;">0</div><div class="lbl">Borrowed</div></div>
        <div class="metric-card-small"><div class="val" id="metric-lost" style="color:#ef4444;">0</div><div class="lbl">Lost</div></div>
        <div class="metric-card-small"><div class="val" id="metric-overdue" style="color:#fbbf24;">0</div><div class="lbl">Overdue</div></div>
    </aside>

    <script>
        let db = JSON.parse(localStorage.getItem('libraryDB'));
        function logout() { sessionStorage.clear(); window.location.href='login.html'; }

        function updateMetrics() {
            document.getElementById('metric-students').innerText = db.students.length;
            document.getElementById('metric-books').innerText = db.books.length;
            const bCount = db.books.filter(b => b.status === 'Borrowed').length;
            document.getElementById('metric-borrowed').innerText = bCount;
            document.getElementById('metric-lost').innerText = db.books.filter(b => b.status === 'Lost').length;
            document.getElementById('metric-overdue').innerText = Math.floor(bCount * 0.1); 
        }

        function render() {
            const tbody = document.getElementById('tableBody');
            const term = document.getElementById('search').value.toLowerCase();
            tbody.innerHTML = '';
            db.students.forEach(s => {
                if(s.name.toLowerCase().includes(term) || s.id.toLowerCase().includes(term)) {
                    tbody.innerHTML += `<tr><td>${s.id}</td><td>${s.name}</td><td>${s.course}</td><td>${s.dept}</td><td><button onclick="del('${s.id}')" class="btn-sm btn-danger" style="border:none; border-radius:4px; cursor:pointer;">Delete</button></td></tr>`;
                }
            });
        }

        function addStudent(e) {
            e.preventDefault();
            const id = document.getElementById('newId').value;
            if(db.students.find(s => s.id === id)) return alert('ID already exists');
            db.students.push({ id: id, name: document.getElementById('newName').value, course: document.getElementById('newCourse').value, dept: document.getElementById('newDept').value, contact: document.getElementById('newEmail').value });
            localStorage.setItem('libraryDB', JSON.stringify(db));
            render();
            updateMetrics();
            e.target.reset();
        }

        function del(id) {
            if(confirm('Delete student?')) {
                db.students = db.students.filter(s => s.id !== id);
                localStorage.setItem('libraryDB', JSON.stringify(db));
                render();
                updateMetrics();
            }
        }

        function filterTable() { render(); }
        render();
        updateMetrics();
    </script>
</body>
</html>