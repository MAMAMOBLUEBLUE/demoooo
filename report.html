<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lost Books Report</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <aside class="sidebar">
        <div class="brand">Library Admin</div>
        <nav>
            <a href="index.html">Dashboard</a>
            <a href="students.html">Students</a>
            <a href="books.html">Books</a>
            <a href="transaction.html">Transactions</a>
            <a href="payment.html">Payments</a>
            <a href="report.html" class="active">Reports</a>
            <a href="backup.html">Backup & Restore</a>
            <a href="#" onclick="logout()" class="logout">Logout</a>
        </nav>
    </aside>

    <main class="content">
        <h1 style="color: #ef4444;">Lost Books Report</h1>
        <div class="card">
            <table>
                <thead><tr><th>Book Title</th><th>Accession</th><th>Last Known Holder</th><th>Date Reported</th></tr></thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
    </main>

    <!-- RIGHT SIDEBAR -->
    <aside class="metrics">
        <h3>Summary</h3>
        <div class="metric-card-small"><div class="val" id="metric-students">0</div><div class="lbl">Students</div></div>
        <div class="metric-card-small"><div class="val" id="metric-books">0</div><div class="lbl">Books</div></div>
        <div class="metric-card-small"><div class="val" id="metric-borrowed" style="color:#f97316;">0</div><div class="lbl">Borrowed</div></div>
        <div class="metric-card-small"><div class="val" id="metric-lost" style="color:#ef4444;">0</div><div class="lbl">Lost</div></div>
        <div class="metric-card-small"><div class="val" id="metric-overdue" style="color:#fbbf24;">0</div><div class="lbl">Overdue</div></div>
    </aside>

    <script>
        let db = JSON.parse(localStorage.getItem('libraryDB'));
        function logout() { sessionStorage.clear(); window.location.href='login.html'; }

        function updateMetrics() {
            document.getElementById('metric-students').innerText = db.students.length;
            document.getElementById('metric-books').innerText = db.books.length;
            const bCount = db.books.filter(b => b.status === 'Borrowed').length;
            document.getElementById('metric-borrowed').innerText = bCount;
            document.getElementById('metric-lost').innerText = db.books.filter(b => b.status === 'Lost').length;
            document.getElementById('metric-overdue').innerText = Math.floor(bCount * 0.1); 
        }

        const tbody = document.getElementById('tbody');
        const lostTx = db.transactions.filter(t => t.type === 'Lost');
        lostTx.forEach(t => {
            const bookTitle = db.books.find(b => b.acc === t.bookAcc)?.title || t.bookAcc;
            const studentName = db.students.find(s => s.id === t.studentId)?.name || t.studentId;
            tbody.innerHTML += `<tr><td>${bookTitle}</td><td>${t.bookAcc}</td><td>${studentName}</td><td>${t.date}</td></tr>`;
        });
        if(lostTx.length === 0) tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No lost books reported.</td></tr>';
        
        updateMetrics();
    </script>
</body>
</html>